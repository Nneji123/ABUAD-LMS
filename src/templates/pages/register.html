<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>Register Student for COE {{course_code}}</title>
		<!-- Font Awesome JS -->
		<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/solid.js"
			integrity="sha384-tzzSw1/Vo+0N5UhStP3bvwWPq+uvzCMfrN1fEFe+xBmv1C/AtVX5K0uZtmcHitFZ"
			crossorigin="anonymous"></script>
		<script defer src="https://use.fontawesome.com/releases/v5.0.13/js/fontawesome.js"
			integrity="sha384-6OIrr52G08NpOFSZdxxz1xdNSndlD4vdcf/q2myIUVO0VsqaGHJsB0RaBE01VTOY"
			crossorigin="anonymous"></script>
		<link rel="icon" type="image/ico" href="{{ url_for('static',filename='img/logo.png') }}" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/webcamjs/1.0.26/webcam.min.js"
			integrity="sha512-dQIiHSl2hr3NWKKLycPndtpbh5iaHLo6MwrXm7F0FM5e+kL2U16oE9uIwPHUl6fQBeCthiEuV/rzP3MiAB8Vfw=="
			crossorigin="anonymous" referrerpolicy="no-referrer"></script>
		<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.0.3/socket.io.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
		<link rel='stylesheet' href='https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css'>
		<link rel="stylesheet"
			href="https://mdbcdn.b-cdn.net/wp-content/themes/mdbootstrap4/docs-app/css/dist/mdb5/standard/core.min.css">
		<link rel="stylesheet" type="text/css" href="{{
			url_for('static',filename='main.css') }}">
	</head>

	<body>

		<!-- Navbar -->
		<nav class="navbar navbar-expand-md navbar-light navbar-bg gradient-custom-2">
			<a class="navbar-brand" href="#">
				<style>
					.navbar-brand img {
						height: 50px;
						width: auto;
					}

					.gradient-custom-2 {
						/* fallback for old browsers */
						background: #fccb90;

						/* Chrome 10-25, Safari 5.1-6 */
						background: -webkit-linear-gradient(to right, #ee7724, #d8363a, #dd3675, #b44593);

						/* W3C, IE 10+/ Edge, Firefox 16+, Chrome 26+, Opera 12+, Safari 7+ */
						background: linear-gradient(to right, #9d24ee, #d836c2, #dd36ab, #b44593);
					}
				</style>
				<img src="{{ url_for('static', filename='img/logo.png') }}" alt="ABUAD LMS
					Logo">
			</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav"
				aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNav">
				<ul class="navbar-nav ml-auto">
					<li class="nav-item">
						<a class="nav-link" href="/lecturer">Back Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="/logout">Logout</a>
					</li>
				</ul>
			</div>
		</nav>
		<div class="container mt-5">
			<div class="row">
				<!-- <div id="container"> -->
				<video type="hidden" autoplay playsinline id="videoElement" style="display: none;"></video>
				<canvas id="canvas" width="400" height="300" style="display: none;"></canvas>
				<!-- </div> -->
				<div class="col-md-6">
					<div class="card">
						<div class="card-body">
							<img id="photo" class="card-img-top img-fluid" alt="Register Face" height="600">
						</div>
					</div>
				</div>
				<div class="col-md-6">
					<h2>Register Student for COE {{course_code}}</h2>
					<form method="post">
						<div class="form-group">
							<label for="name">Name:</label>
							<input type="text" class="form-control form-control-lg" id="name" name="name"
								required="True">
						</div>
						<div class="form-group">
							<label for="matric">Matric Number:</label>
							<input type="text" class="form-control form-control-lg" id="matric" name="matric"
								required="True">
						</div>
						<div class="form-group">
							<label for="email">Department:</label>
							<input type="text" class="form-control form-control-lg" id="email" name="dept"
								required="True">
						</div>
						<input type="submit" value="Capture" id="capture-button" name="click" class="btn btn-primary
							btn-lg" style="background: linear-gradient(to right, #9d24ee, #d836c2, #dd36ab, #b44593);" />
					</form>

					{% for message in get_flashed_messages() %}
					<div class="modal fade" id="successModal" tabindex="-1" role="dialog"
						aria-labelledby="successModalLabel" aria-hidden="true">
						<div class="modal-dialog" role="document">
							<div class="modal-content">
								<div class="modal-header">
									<h5 class="modal-title" id="successModalLabel">Success!</h5>
									<button type="button" class="close" data-dismiss="modal" aria-label="Close">
										<span aria-hidden="true">&times;</span>
									</button>
								</div>
								<div class="modal-body">
									<p>{{ message }}</p>
									<p>Do you want to register another student?</p>
								</div>
								<div class="modal-footer">
									<button type="button" class="btn btn-secondary" data-dismiss="modal">No</button>
									<a href="/register_student/{{course_code}}" class="btn btn-primary">Yes</a>
								</div>
							</div>
						</div>
					</div>
					{% endfor %}



					<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
					<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
					<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
					<script src="{{ url_for('static',filename='script.js') }}"></script>
					<script>
						Webcam.set({
							width: 640,
							height: 480,
							dest_width: 640,
							dest_height: 480,
							image_format: 'jpeg',
							jpeg_quality: 90,
							force_flash: false,
							flip_horiz: true,
							fps: 45
						});

						Webcam.attach('#canvas');

						var captureButton = document.getElementById('capture-button');
						captureButton.addEventListener('click', function (event) {
							event.preventDefault();
							Webcam.snap(function (data_uri) {
								// display the captured image in the canvas element
								var canvas = document.getElementById('canvas');
								var context = canvas.getContext('2d');
								var img = new Image();
								img.onload = function () {
									context.drawImage(img, 0, 0);
								}
								img.src = data_uri;

								// save the captured image
								var link = document.createElement('a');
								var name = document.getElementsByName("name")[0].value.toUpperCase();
								var matric = document.getElementsByName("matric")[0].value.replace('/', ' ');
								var dept = document.getElementsByName("dept")[0].value.toLowerCase().replace(/\b\w/g, function (l) { return l.toUpperCase(); });

								// var imagename = name + "-" + matric + "-" + dept + ".jpg"
								// console.log(imagename)
								fetch('/register_student/{{course_code}}', {
									method: 'POST',
									headers: {
										'Content-Type': 'application/json'
									},
									body: JSON.stringify({
										data_uri: data_uri,
										name: name,
										matric: matric,
										dept: dept
									})

								})
									.then(response => {
										if (response.ok) {
											console.log('Image saved successfully');
											$('#successModal').modal('show');	 // Show modal after successful submission
											document.getElementsByName("name")[0].value = "";
											document.getElementsByName("matric")[0].value = "";
											document.getElementsByName("dept")[0].value = "";
											console.log("Success")
										} else {
											console.error('Error saving image:', response.statusText);
										}
									})
									.catch(error => {
										console.error('Error saving image:', error);
									});
							});
						});
					</script>

	</body>

</html>